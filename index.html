<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Digital Signage | Menu Online</title>
    <link rel="stylesheet" href="./style.css" />
  </head>

  <body>
    <div class="landing-page" id="landingPage">
      <div class="net-server">
        <div class="net">
          <span>Internet : </span> <span id="internet-status">NO</span>
        </div>
        <div class="server">
          <span>Server : </span> <span id="server-status">DOWN</span>
        </div>
      </div>
      <div class="screen-id"><span>Screen ID: </span> <span>999036</span></div>
      <div class="image-slider-div" id="image-slider">
        <img id="slider-image" src="" />
      </div>
    </div>

    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>

    <script>
      var timeout = null; // Store the timeout reference

      // Function to start the image slider
      function startSlider(arg) {
        var imageArrr = null;
        document.getElementById("image-slider").style.display = "block";

        // Default set of images
        var old = [
            {
              _id: "678690804fb1815c85600614",
              mediaId:
                "https://neweditor.menspal.com/backds/api/media/image?path=test-user-media/620c74aab1f48f709b5ddbea/Untitled Design_97466599.jpeg",
              contentType: "IMAGE",
              playlistId: "67815f5a4fb1815c853d0bfa",
              duration: 5,
              isIncluded: true,
              other_a: "",
              other_b: "",
              mediaName: "Untitled Design_97466599",
              image_url:
                "test-user-media/620c74aab1f48f709b5ddbea/Untitled Design_97466599.jpeg",
            },
            {
              _id: "678690804fb1815c85600615",
              mediaId:
                "https://neweditor.menspal.com/backds/api/media/image?path=test-user-media/620c74aab1f48f709b5ddbea/Untitled Design_59853382.jpeg",
              contentType: "IMAGE",
              playlistId: "67815f5a4fb1815c853d0bfa",
              duration: 5,
              isIncluded: true,
              other_a: "",
              other_b: "",
              mediaName: "Untitled Design_59853382",
              image_url:
                "test-user-media/620c74aab1f48f709b5ddbea/Untitled Design_59853382.jpeg",
            },
          ];

        if (arg) {
          imageArrr = old;
        } else {
          imageArrr = arg;
        }
        var index = 0; // To keep track of the current image index
        timeout = setInterval(() => {
            console.log('run',imageArrr[index].mediaId);
          document.getElementById("slider-image").src = imageArrr[index].mediaId;
          index = (index + 1) % imageArrr.length;
        }, 2000);
      }

      // Function to stop the image slider
      function stopSlider() {
        if (timeout) {
          clearInterval(timeout); // Stop the interval
          timeout = null; // Reset the timeout reference
        }
      }

      // Update the network status
      function updateNetworkStatus() {
        const isOnline = navigator.onLine;
        const networkStatusText = document.getElementById("network-status");
        // Set network status message
        if (isOnline) {
          document.getElementById("internet-status").textContent = "ONLINE";
        } else {
          document.getElementById("internet-status").textContent = "OFFLINE";
        }
      }

      // Window onload function
      window.onload = function () {
        document.getElementById("image-slider").style.display = "none";
        const BASE_URL = "https://react.tjcg.in"; // Updated BASE_URL with host and port
        const SCREEN_ID = "999036"; // This is the screen number as per your screen_data
        // Call the function to update the playlist with images and start the fade-in effect
        // Connect to the socket.io server
        const socket = io(BASE_URL, {
          path: "/socket.live",
          query: {
            screenNo: SCREEN_ID,
          },
          transports: ["websocket"],
        });

        // When the connection is established
        socket.on("connect", function (response) {
          console.log("Socket connected to server", response);
          document.getElementById("server-status").textContent =
            "Socket connected to server";
        });

        socket.on("use_our_template_data", function (data) {
          console.log("GET:::use_our_template_data", data);
        });
        socket.on("playlist_data", function (data) {
          console.log("GET::: playlist_data", data);
          stopSlider();
          console.log(data.playlist);
          startSlider(data.playlist);
        });

        socket.on("playlist_data", function (data) {
          console.log("GET::: playlist_data", data);
        });
        socket.on("CHECK_ONLINE_STATUS", function (data) {
          console.log("GET::: CHECK_ONLINE_STATUS", data);
        });
        socket.on("CLOSE_SCREEN_APP", function (data) {
          console.log("GET::: CLOSE_SCREEN_APP", data);
        });
        socket.on("UPGRADE_SCREEN_APP", function (data) {
          console.log("GET::: UPGRADE_SCREEN_APP", data);
        });
        socket.on("ROTATE_SCREEN", function (data) {
          console.log("GET::: ROTATE_SCREEN", data);
        });
        socket.on("RESET_SCREEN_APP", function (data) {
          console.log("GET::: RESET_SCREEN_APP", data);
        });
        socket.on("RELOAD_PLAYER_APP", function (data) {
          console.log("GET::: RELOAD_PLAYER_APP", data);
        });
        socket.on("TAKE_SCREEN_SNAP_SHOT", function (data) {
          console.log("GET::: TAKE_SCREEN_SNAP_SHOT", data);
        });
        socket.on("USER_REBOOT_APP", function (data) {
          console.log("GET::: USER_REBOOT_APP", data);
        });
        socket.on("SHUTDOWN_SYSTEM", function (data) {
          console.log("GET::: SHUTDOWN_SYSTEM", data);
        });
        socket.on("LAUNCH_SCREEN_APP", function (data) {
          console.log("GET::: LAUNCH_SCREEN_APP", data);
        });
        socket.on("UPLOAD_NEW_APK_FILE", function (data) {
          console.log("GET::: UPLOAD_NEW_APK_FILE", data);
        });
        socket.on("UPLOAD_ROOT_APP_FILE", function (data) {
          console.log("GET::: UPLOAD_ROOT_APP_FILE", data);
        });
        socket.on("UPLOAD_COMMEND", function (data) {
          console.log("GET::: UPLOAD_COMMEND", data);
        });
        socket.on("ADD_EDIT_TV_SCHEDULER", function (data) {
          console.log("GET::: ADD_EDIT_TV_SCHEDULER", data);
        });
        socket.on("screen_data", function (data) {
          console.log("GET::: screen_data", data);
        });
        socket.on("custom_layout_data", function (data) {
          console.log("GET::: custom_layout_data", data);
        });
        socket.on("playlist_data", function (data) {
          console.log("GET::: playlist_data", data);
        });
        socket.on("use_our_template_data", function (data) {
          console.log("GET::: use_our_template_data", data);
        });
        socket.on("update_media_in_screen", function (data) {
          console.log("GET::: update_media_in_screen", data);
        });

        // Update network status initially
        updateNetworkStatus();
      };

      // Listen to online and offline events
      window.addEventListener("online", updateNetworkStatus);
      window.addEventListener("offline", updateNetworkStatus);
    </script>
  </body>
</html>
